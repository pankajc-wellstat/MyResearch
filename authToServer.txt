export const authToServer = async (data) => {
  try {
    authToken = null;

    for (let i = 0; i < REGIONS.length; i++) {
      const region = REGIONS[i];
      const backendUrl =
        region === US_EAST_1
          ? appConfig.backendurl
          : appConfig.backendurl.replaceAll(
              ".wellstat.io",
              `-${region}.wellstat.io`,
            );

      const cfg = {
        method: "post",
        url: `${backendUrl}/auth`,
        data,
        timeout: 2000,
        headers: { "Content-type": "application/json" },
      };

      const response = await axios(cfg);
      const responseData = response?.data ?? {};

      if (
        typeof responseData === "string" &&
        (responseData?.indexOf("https://accounts.google.com") !== -1 ||
          responseData?.indexOf("https://login.microsoftonline.com") !== -1 ||
          responseData?.indexOf("/login?token=") !== -1)
      ) {
        window.location.href = responseData;

        return;
      }

      if (responseData?.rc === "OK") {
        const context = response.data.context;
        const { token: authToken } = context;

        localStorage.setItem(AUTH_TOKEN_KEY, authToken);
        localStorage.setItem(BACKEND_URL_KEY, backendUrl);

        return { status: response?.statusText, data: responseData };
      }

      if (i < REGIONS.length - 1) continue;

      return { status: response?.statusText, data: responseData };
    }
  } catch (error) {}
};
