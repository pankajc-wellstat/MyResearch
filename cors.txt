ALTER TABLE recalibration_process ADD COLUMN is_registered TINYINT(1) DEFAULT 0 AFTER is_completed
E461D4064F265429 NPT-93379-002
E461D4064F202833 NPT-93379-004
E461D4064F0A2E29 NPT-93379-005
E461D4064F0A2F2A NPT-93379-006
DELETE FROM recalibration_process WHERE id BETWEEN 1 AND 100;

DELETE es
FROM equipment_sensor es
JOIN equipment e ON e.id = es.equipment_id
WHERE e.name IN ('E461D4064F265429','E461D4064F202833','E461D4064F0A2E29','E461D4064F0A2F2A');

DELETE d
FROM datapoints d
JOIN equipment_sensor es ON es.datapoint_id = d.datapoint_id
JOIN equipment e ON e.id = es.equipment_id
WHERE e.name IN ('E461D4064F265429','E461D4064F202833','E461D4064F0A2E29','E461D4064F0A2F2A');

UPDATE calibration_data_ecsense set equipment_id = NULL, datapoint_id = 0 
where parent_serial_number IN ('NPT-93379-002','NPT-93379-003','NPT-93379-004','NPT-93379-005','NPT-93379-006'); 
DELETE from equipment e where e.name IN ('E461D4064F265429','E461D4064F202833','E461D4064F0A2E29','E461D4064F0A2F2A');

import { localMachDb, MachDB, prodMachDb } from "../connect/database";
import { Tunnels } from "../connect/jumpbox";
import { Recipe } from "../index";

const exec = async (db: MachDB) => {
    await db.executeSQL(
      `CREATE TABLE recalibration_process 
      (
        id                      bigint NOT NULL     AUTO_INCREMENT,
        manufacturer_id         char(36)            NOT NULL,
        recalibration_timer     timestamp NULL      DEFAULT NULL,
        uploaded_data           text NOT NULL       DEFAULT NULL,
        is_completed            tinyint(1)          DEFAULT '0',
        created_at              datetime NOT NULL   DEFAULT CURRENT_TIMESTAMP,
        updated_at              datetime NOT NULL   DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (id)
        )`,
      [],
    );
};

const run = async () => {
  const db = await localMachDb();
  await exec(db);
};

const runProd = async ({ machTunnel }: Tunnels) => {
  const db = await prodMachDb(machTunnel);
  await exec(db);
};

export const recipe: Recipe = {
  name: "createAirscanRecalibrationProcessTable",
  description:
    "Create new table for Device Recalibration Processes.",
  run,
  runProd,
};

CREATE TABLE airscan_recalibration_process (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cm_id CHAR(36) NOT NULL,
    recal_timer_window TIMESTAMP NULL DEFAULT NULL,
    listtoupload TEXT NOT NULL,
    is_completed BOOLEAN DEFAULT 0,
    date_created DATETIME DEFAULT CURRENT_TIMESTAMP
);
// Add state variable
const [isRegisteringRecalibration, setIsRegisteringRecalibration] = useState(false);

// Update onRegisterClick handler
const onRegisterClick = async () => {
  let filteredParsedList: UploadedAirscan[] = [];
  if (activeTab === DEVICEREG_TABS.RECALIBRATION) {
    setIsRegisteringRecalibration(true); // Start registration
    const parsedListToUploadJson: UploadedAirscan[] =
      lastListToUploadReCal ?? [];
    const successfulDevicesMap = new Map(
      Object.values(checkedAirscanUpload?.devices || [])
        .filter((d) => d.recalibrationStatus?.toLowerCase() === "success")
        .map((d) => [d.name, d]),
    );
    filteredParsedList = parsedListToUploadJson.filter((item) =>
      successfulDevicesMap.has(item.deviceId),
    );
  } else {
    filteredParsedList = lastListToUploadNonCal ?? [];
  }

  setModalState({
    open: true,
    message:
      "Register the test WellStat Air devices? This will allow them to be assigned to existing buildings.",
    onConfirm: async () => {
      await dispatch(
        orphanUploadedAirscans({ uploadedAirscans: filteredParsedList }),
      );
      await dispatch(
        updateCalibrationTimestamp({
          uuid,
          timestamp: false,
          listtoupload: "",
        }),
      );
      setModalState((prev) => ({ ...prev, open: false }));
      if (activeTab === DEVICEREG_TABS.RECALIBRATION) {
        setIsRegisteringRecalibration(false); // End registration
      }
    },
    hideFooter: false,
  });
};

// Update button disabled logic
<Button
  color="primary"
  onClick={onRegisterClick}
  disabled={
    activeTab === DEVICEREG_TABS.RECALIBRATION
      ? registerAfterRecalibrationDisabled || isRegisteringRecalibration
      : registerBtnDisabled
  }
>
  Register Device(s)
</Button>

if (activeTab === "recalibration") {
          state.checkedAirscanUploadReCal = {
            ...state.checkedAirscanUploadReCal,
            devices: {},
          };
        } else {
          state.checkedAirscanUploadNonCal = response;
        }E461D4064F265429
NPT-93379-002
.inner-card {
  margin-bottom: 2rem;
  box-shadow: 0 4px 24px 0 rgba(34, 41, 47, 0.1);
  border-radius: 25px;
  transition:
    all 0.3s ease-in-out,
    background 0s,
    color 0s,
    border-color 0s;
}

.custom-card {
  position: relative;
  border-radius: 12px;
  overflow: hidden;
}

.left-line {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 5px;
  border-radius: 0;
}

.device-button-group .btn {
  font-size: 18px;
}

// Marker hover area
.map-marker-hover-area {
  position: absolute;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: transparent;
  z-index: 1000;
}

// Tooltip styling
.tooltip.custom-map-tooltip .arrow::before,
.custom-map-tooltip .arrow::before,
.tooltip.custom-map-tooltip .tooltip-arrow,
.custom-map-tooltip .tooltip-arrow {
  background: white !important;
  border: none !important;
}

// Ensure tooltip background is white and text is black, override Reactstrap defaults
.tooltip.custom-map-tooltip,
.custom-map-tooltip {
  background-color: #fff !important;
  color: #000 !important;
  border: 1px solid #ccc !important;
  border-radius: 8px !important;
  box-shadow: none !important;
  padding: 10px !important;
  max-width: 250px !important;
  z-index: 9999 !important;
  text-align: left !important;
}

.tooltip.custom-map-tooltip .tooltip-inner,
.custom-map-tooltip .tooltip-inner {
  background-color: #fff !important;
  color: #000 !important;
  border-radius: 8px !important;
  box-shadow: none !important;
  text-align: left !important;
}

.custom-map-tooltip-content {
  text-align: left;
}

.custom-map-tooltip-row {
  margin-bottom: 6px;
  font-size: 12px;
}

.equipment-map-container {
  display: flex;
  height: 100%;
}

.device-calibration-datepicker .form-control[readonly] {
  background-color: #fff !important;
  opacity: 1 !important;
}
.dark-layout .device-calibration-datepicker .form-control[readonly] {
  background-color: #283046 !important;
  opacity: 1 !important;
}
// Device cards grid: always 4 columns, consistent width, with spacing from filter
.mini-cards-container {
  display: grid;
  grid-template-columns: repeat(4, minmax(220px, 1fr));
  gap: 16px;
  margin-top: 24px;
  
  &.vertical {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-top: 24px;
  }
}

.mini-card-wrapper {
  width: 100%;
  max-width: 320px;
  min-width: 220px;
  margin: 0 auto;
}



.filter-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;

  .filter-col.horizontal {
    flex: 1;        
    min-width: 200px;  
  }

  .filter-col.vertical {
    flex: 1 1 100%;   
  }
}









